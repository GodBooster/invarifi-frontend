'use client';

import { useRouter } from 'next/navigation';
import {
  type CSSProperties,
  type MouseEvent,
  memo,
  useCallback,
  useRef,
} from 'react';

import { EarnInfoBlock } from './earn-info-block';

import { type selectedRowValue } from '../earn/pool';

import { type CubeWithApyAndTvl } from '@/actions/get-all-cubes';
import { chainImages } from '@/constants/vaults';
import { apyFormatter } from '@/lib/apy-formatter';
import {
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from '@/ui/accordion';
import { VaultArrow } from '@/ui/icons';

type PoolProps = {
  cube: CubeWithApyAndTvl;
  style?: CSSProperties;
  rowIndex: number;
  columnIndex: number;
  open: selectedRowValue;
  onClick: (
    rowIndex: number,
    columnIndex: number,
    value?: 'open' | 'boost',
  ) => void;
};
export const EarnPoolCard = memo(
  ({ cube, style, onClick, rowIndex, columnIndex, open }: PoolProps) => {
    const router = useRouter();

    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    const openRef = useRef();
    const handleClick = useCallback(
      () => router.push(`/earn/${cube.id}`),

      [router, cube.id],
    );
    const handleOpen = useCallback(
      (e: MouseEvent<HTMLButtonElement>) => {
        e.stopPropagation();
        onClick(rowIndex, columnIndex, 'open');
      },
      [rowIndex, columnIndex, onClick],
    );

    return (
      <div className="group/card h-fit  transition-all" style={style}>
        <AccordionItem
          onClick={handleClick}
          value={`item-${cube.id}`}
          className="block cursor-pointer rounded-[16px] border border-slate-200 bg-white p-[16px] pb-0 shadow-sm transition-all duration-300 hover:border-primary hover:shadow-[0_0_20px_rgba(255,99,64,0.4)]"
        >
          <div className="mb-[12px] truncate text-slate-800 font-medium">{cube.name || cube.id}</div>
          <div className="mb-[12px] flex items-center rounded-[8px] bg-slate-100 px-[12px] py-[10px] text-[16px] font-semibold text-primary">
            {cube.stable}
          </div>
          <div className="relative flex justify-between  pb-[16px]">
            <div>
              <h3 className="text-[14px] font-semibold leading-[20px] text-slate-500">
                APY
              </h3>
              <div className="flex gap-2">
                <h4 className="text-[20px] font-semibold leading-[30px] text-primary">
                  {apyFormatter(cube.avgAPY)}
                </h4>
                {/* {vault.boost && (
                <div className="flex items-center gap-1 rounded-lg bg-light-purple px-2 py-[2px] text-xs text-primary">
                  Boost <InfoCircle light />
                </div>
              )} */}
              </div>
            </div>
            <div className="flex flex-col items-end justify-between">
              <h3 className="text-right text-[14px] font-semibold leading-[20px] text-slate-500">
                Chain
              </h3>
              {chainImages[cube.network] ? (
                chainImages[cube.network]
              ) : (
                <div className="text-slate-800">{cube.network}</div>
              )}
            </div>
            <span className="absolute  bottom-0 w-[40%] border-b-2 border-dashed border-slate-300"></span>
            <span className="absolute  bottom-0 right-0 w-[40%] border-b-2 border-dashed border-slate-300"></span>
          </div>
          <div className="relative flex -translate-y-[10px] justify-center overflow-hidden">
            <div className=" flex  w-[56px] justify-center bg-inherit">
              <AccordionTrigger
                className="p-0"
                chevronHidden
                onClick={handleOpen}
              >
                <div
                  className={`group transition-all ${open ? 'rotate-180' : ''}`}
                >
                  <VaultArrow />
                </div>
              </AccordionTrigger>
            </div>
          </div>

          <AccordionContent>
            <EarnInfoBlock cube={cube} />
          </AccordionContent>
        </AccordionItem>
      </div>
    );
  },
);

EarnPoolCard.displayName = 'EarnPoolCard';
